<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ù…Ø§ÛŒ Ù…ÙˆÙ‡ÛŒØªÙˆ | My Mojito</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Font: Vazirmatn -->
    <link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/Vazirmatn-font-face.css" rel="stylesheet" type="text/css" />

    <style>
        body {
            font-family: 'Vazirmatn', sans-serif;
            -webkit-tap-highlight-color: transparent;
            overscroll-behavior-y: none; /* Prevent pull-to-refresh on mobile */
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 4px;
        }
        ::-webkit-scrollbar-track {
            background: transparent;
        }
        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 10px;
        }
        .dark ::-webkit-scrollbar-thumb {
            background: #475569;
        }

        /* Animation Classes */
        .fade-in {
            animation: fadeIn 0.5s cubic-bezier(0.16, 1, 0.3, 1) forwards;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .slide-up {
            animation: slideUp 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards;
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(40px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .scale-in {
            animation: scaleIn 0.3s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
        }

        @keyframes scaleIn {
            from { transform: scale(0.9); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        
        /* Smooth inputs */
        input, select, textarea {
            transition: all 0.2s ease-in-out;
        }

        /* Hide file input */
        input[type="file"] {
            display: none;
        }
    </style>
    
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        mojito: {
                            light: '#f0fdf4',
                            DEFAULT: '#22c55e',
                            dark: '#14532d',
                            accent: '#facc15',
                        }
                    },
                    padding: {
                        'safe': 'env(safe-area-inset-bottom)'
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gray-50 text-gray-800 transition-colors duration-300 select-none overflow-hidden fixed w-full h-full">
    <div id="root" class="h-full overflow-y-auto"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- Utilities ---
        const getPersianDate = (date = new Date()) => {
            return new Intl.DateTimeFormat('fa-IR', {
                weekday: 'long',
                day: 'numeric',
                month: 'long',
                year: 'numeric'
            }).format(date);
        };

        const getPersianDay = (date = new Date()) => {
            return new Intl.DateTimeFormat('fa-IR', { weekday: 'short' }).format(date);
        };

        const getStorageKeyDate = (date = new Date()) => {
            return new Intl.DateTimeFormat('fa-IR-u-nu-latn', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit'
            }).format(date).replace(/\//g, '-');
        };

        // Persistent State Hook
        const useStickyState = (defaultValue, key) => {
            const [value, setValue] = useState(() => {
                const stickyValue = window.localStorage.getItem(key);
                return stickyValue !== null ? JSON.parse(stickyValue) : defaultValue;
            });
            useEffect(() => {
                window.localStorage.setItem(key, JSON.stringify(value));
            }, [key, value]);
            return [value, setValue];
        };

        // --- AI/Processing Logic (Client Side) ---
        const processText = (text) => {
            if (!text) return null;
            
            // 1. Clean Text
            const cleanText = text.replace(/\s+/g, ' ').trim();
            const sentences = cleanText.match(/[^.?!ØŸ]+[.?!ØŸ]+|[^.?!ØŸ]+$/g) || [cleanText];
            const cleanSentences = sentences.map(s => s.trim()).filter(s => s.length > 15); // Filter short sentences

            // 2. Identify Keywords (Simple Heuristic: Length > 4 chars, not common stop words)
            const stopWords = ['Ø§Ø³Øª', 'Ø¨ÙˆØ¯', 'Ø´Ø¯', 'Ù…ÛŒ', 'Ú©Ù‡', 'Ø§Ø²', 'Ø¨Ù‡', 'Ø¨Ø§', 'Ø¯Ø±', 'Ø±Ø§', 'Ø¨Ø±Ø§ÛŒ', 'Ø§ÛŒÙ†', 'Ø¢Ù†'];
            const words = cleanText.split(/[\sØŒØ›.]+/).filter(w => w.length > 3 && !stopWords.includes(w));
            
            // 3. Generate Flashcards
            const flashcards = cleanSentences.slice(0, 5).map(sentence => {
                const sentenceWords = sentence.split(' ');
                // Find a candidate word to hide
                const candidate = sentenceWords.find(w => w.length > 4 && !stopWords.includes(w)) || sentenceWords[Math.floor(Math.random() * sentenceWords.length)];
                return {
                    q: sentence.replace(candidate, '________'),
                    a: candidate
                };
            }).filter(card => card.a);

            // 4. Generate Quiz
            const quiz = cleanSentences.slice(0, 3).map((sentence, index) => {
                const sentenceWords = sentence.split(' ');
                const candidate = sentenceWords.find(w => w.length > 4 && !stopWords.includes(w)) || sentenceWords[0];
                
                // Generate wrong answers from other parts of text
                const wrongAnswers = words
                    .filter(w => w !== candidate)
                    .sort(() => 0.5 - Math.random())
                    .slice(0, 2);
                
                const options = [...wrongAnswers, candidate].sort(() => 0.5 - Math.random());
                
                return {
                    id: index,
                    question: sentence.replace(candidate, '...'),
                    options: options,
                    answer: candidate
                };
            });

            // 5. Generate Summary
            let summary = "";
            if (cleanSentences.length > 2) {
                summary = `${cleanSentences[0]} ... ${cleanSentences[Math.floor(cleanSentences.length / 2)]} ... ${cleanSentences[cleanSentences.length - 1]}`;
            } else {
                summary = cleanText;
            }

            return { flashcards, quiz, summary };
        };

        // --- Common Components ---
        const Toast = ({ message, type, onClose }) => {
            useEffect(() => {
                const timer = setTimeout(onClose, 3000);
                return () => clearTimeout(timer);
            }, []);

            const bgClass = type === 'success' ? 'bg-green-500' : 'bg-red-500';

            return (
                <div className={`fixed top-6 left-1/2 transform -translate-x-1/2 z-[100] px-6 py-3 rounded-2xl shadow-xl text-white font-bold flex items-center gap-2 slide-up ${bgClass} backdrop-blur-sm bg-opacity-90`}>
                    {type === 'success' ? <i data-lucide="check-circle" className="w-5 h-5"></i> : <i data-lucide="alert-circle" className="w-5 h-5"></i>}
                    <span className="text-sm">{message}</span>
                </div>
            );
        };

        // 1. Auth Screen
        const AuthScreen = ({ onLogin }) => {
            const [formData, setFormData] = useState({ name: '' });
            const [error, setError] = useState('');

            const handleSubmit = (e) => {
                e.preventDefault();
                if (!formData.name.trim()) {
                    setError('Ù„Ø·ÙØ§ Ù†Ø§Ù… Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯');
                    return;
                }
                onLogin({ ...formData, avatar: null });
            };

            return (
                <div className="min-h-screen flex flex-col items-center justify-center p-6 bg-gradient-to-br from-green-400 to-yellow-300 relative overflow-hidden">
                    <div className="absolute top-[-50px] right-[-50px] w-40 h-40 bg-white opacity-20 rounded-full blur-2xl animate-pulse"></div>
                    <div className="absolute bottom-[-50px] left-[-50px] w-60 h-60 bg-yellow-200 opacity-20 rounded-full blur-3xl"></div>

                    <div className="bg-white/90 backdrop-blur-xl p-8 rounded-[2rem] shadow-2xl w-full max-w-sm fade-in border border-white/50 relative z-10">
                        <div className="text-center mb-8">
                            <div className="w-24 h-24 bg-green-50 rounded-full mx-auto flex items-center justify-center mb-4 shadow-inner ring-4 ring-green-100 animate-bounce-slow">
                                <span className="text-5xl">ğŸ‹</span>
                            </div>
                            <h1 className="text-3xl font-black text-green-700 mb-1 tracking-tight">Ù…Ø§ÛŒ Ù…ÙˆÙ‡ÛŒØªÙˆ</h1>
                            <p className="text-gray-500 text-sm font-medium">Ù‡Ù…Ø±Ø§Ù‡ Ù‡ÙˆØ´Ù…Ù†Ø¯ Ù…Ø·Ø§Ù„Ø¹Ù‡ ØªÙˆ</p>
                        </div>

                        <form onSubmit={handleSubmit} className="space-y-6">
                            <div className="space-y-2">
                                <label className="text-xs font-bold text-gray-500 px-1">Ù†Ø§Ù… Ø´Ù…Ø§</label>
                                <input 
                                    type="text" 
                                    className={`w-full bg-gray-50 border ${error ? 'border-red-400' : 'border-gray-100'} rounded-xl px-4 py-4 focus:bg-white focus:ring-2 focus:ring-green-400 outline-none transition-all text-center text-lg font-bold text-gray-700`}
                                    placeholder="Ù…Ø«Ø§Ù„: Ù…Ø­Ø³Ù† Ø±Ø¶Ø§ÛŒÛŒ"
                                    value={formData.name}
                                    onChange={(e) => {
                                        setFormData({...formData, name: e.target.value});
                                        setError('');
                                    }}
                                    autoFocus
                                />
                                {error && <p className="text-red-500 text-xs text-center font-bold">{error}</p>}
                            </div>

                            <button type="submit" className="w-full bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white font-bold py-4 rounded-xl shadow-lg shadow-green-500/30 transform active:scale-95 transition-all text-lg flex items-center justify-center gap-2">
                                <span>Ø´Ø±ÙˆØ¹ Ú©Ù†ÛŒØ¯</span>
                                <i data-lucide="arrow-left" className="w-5 h-5"/>
                            </button>
                        </form>
                    </div>
                </div>
            );
        };

        // 2. Study Room
        const StudyRoom = ({ user }) => {
            const [tasks, setTasks] = useStickyState([], 'mojito_tasks');
            const [studyLogs, setStudyLogs] = useStickyState({}, 'mojito_study_logs');
            const [isTimerRunning, setIsTimerRunning] = useStickyState(false, 'mojito_is_running');
            
            const [newTask, setNewTask] = useState('');
            const [editingTaskId, setEditingTaskId] = useState(null);
            const [editingText, setEditingText] = useState('');
            
            // Timer logic
            useEffect(() => {
                let interval = null;
                if (isTimerRunning) {
                    interval = setInterval(() => {
                        const todayKey = getStorageKeyDate();
                        setStudyLogs(prev => ({
                            ...prev,
                            [todayKey]: (prev[todayKey] || 0) + 1
                        }));
                    }, 1000);
                } else {
                    clearInterval(interval);
                }
                return () => clearInterval(interval);
            }, [isTimerRunning, setStudyLogs]);

            const formatTime = (seconds) => {
                const hours = Math.floor(seconds / 3600);
                const mins = Math.floor((seconds % 3600) / 60);
                const secs = seconds % 60;
                return `${hours > 0 ? hours + ':' : ''}${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
            };

            const addTask = () => {
                if(!newTask.trim()) return;
                setTasks([...tasks, { id: Date.now(), text: newTask, done: false }]);
                setNewTask('');
            };

            const toggleTask = (id) => {
                setTasks(tasks.map(t => t.id === id ? { ...t, done: !t.done } : t));
            };

            const deleteTask = (e, id) => {
                e.stopPropagation();
                // Add a fading effect before removal logic could be added here, 
                // but for simplicity we just remove
                setTasks(tasks.filter(t => t.id !== id));
            };

            const startEditing = (e, task) => {
                e.stopPropagation();
                setEditingTaskId(task.id);
                setEditingText(task.text);
            };

            const saveTaskEdit = (e) => {
                e.preventDefault();
                setTasks(tasks.map(t => t.id === editingTaskId ? { ...t, text: editingText } : t));
                setEditingTaskId(null);
            };

            const totalTasks = tasks.length;
            const completedTasks = tasks.filter(t => t.done).length;
            const progress = totalTasks === 0 ? 0 : Math.round((completedTasks / totalTasks) * 100);

            // Chart
            const ChartBar = ({ dayDate, label }) => {
                const seconds = studyLogs[dayDate] || 0;
                const hours = seconds / 3600;
                const maxHours = 6; 
                const heightPercent = Math.min((hours / maxHours) * 100, 100);
                
                return (
                    <div className="flex flex-col items-center gap-2 group w-full">
                        <div className="relative w-full max-w-[40px] bg-gray-100 dark:bg-gray-700/50 rounded-xl overflow-hidden h-28 flex items-end ring-1 ring-gray-200 dark:ring-gray-700">
                            <div 
                                style={{ height: `${heightPercent}%` }} 
                                className="w-full bg-gradient-to-t from-green-500 to-green-300 dark:from-green-600 dark:to-green-400 group-hover:from-yellow-400 group-hover:to-yellow-300 transition-all duration-500 rounded-t-sm"
                            ></div>
                        </div>
                        <span className="text-[10px] font-bold text-gray-400 dark:text-gray-500">{label}</span>
                    </div>
                );
            };

            const chartData = [];
            for (let i = 6; i >= 0; i--) {
                const d = new Date();
                d.setDate(d.getDate() - i);
                chartData.push({ dayDate: getStorageKeyDate(d), label: getPersianDay(d) });
            }

            const todayKey = getStorageKeyDate();
            const todayStudySeconds = studyLogs[todayKey] || 0;

            return (
                <div className="space-y-6 pb-24 fade-in">
                    {/* Header */}
                    <div className="flex justify-between items-center bg-white dark:bg-gray-800 p-5 rounded-[2rem] shadow-sm border border-gray-100 dark:border-gray-700/50">
                        <div>
                            <h2 className="text-xl font-black text-gray-800 dark:text-white mb-1">Ø³Ù„Ø§Ù…ØŒ {user.name.split(' ')[0] || 'Ø¯ÙˆØ³Øª Ù…Ù†'} ğŸ‘‹</h2>
                            <p className="text-sm text-green-600 dark:text-green-400 font-bold bg-green-50 dark:bg-green-900/30 px-3 py-1 rounded-full inline-block">
                                {getPersianDate()}
                            </p>
                        </div>
                        <div className="w-14 h-14 rounded-full overflow-hidden border-4 border-yellow-50 dark:border-yellow-900/10 shadow-inner">
                             <img src={user.avatar || `https://api.dicebear.com/7.x/notionists/svg?seed=${user.name}`} alt="avatar" className="w-full h-full object-cover bg-yellow-100" />
                        </div>
                    </div>

                    {/* Timer Card */}
                    <div className="bg-gradient-to-br from-green-500 to-emerald-700 rounded-[2.5rem] p-7 text-white shadow-xl shadow-green-500/20 relative overflow-hidden transition-all duration-300 hover:shadow-green-500/30">
                        <div className="absolute top-0 right-0 w-40 h-40 bg-white opacity-10 rounded-full transform translate-x-12 -translate-y-12 blur-2xl"></div>
                        <div className="absolute bottom-0 left-0 w-32 h-32 bg-yellow-400 opacity-20 rounded-full transform -translate-x-10 translate-y-10 blur-xl"></div>
                        
                        <div className="flex justify-between items-center relative z-10">
                            <div>
                                <p className="text-green-100 text-xs mb-2 font-bold opacity-80 uppercase tracking-widest">ØªØ§ÛŒÙ…Ø± Ù…Ø·Ø§Ù„Ø¹Ù‡ Ø§Ù…Ø±ÙˆØ²</p>
                                <div className="text-5xl font-mono font-bold tracking-tight drop-shadow-sm tabular-nums">
                                    {formatTime(todayStudySeconds)}
                                </div>
                            </div>
                            <button 
                                onClick={() => setIsTimerRunning(!isTimerRunning)}
                                className={`w-16 h-16 rounded-2xl flex items-center justify-center shadow-lg transition-all transform active:scale-95 duration-300 ${isTimerRunning ? 'bg-white/20 hover:bg-white/30 text-white backdrop-blur-md border border-white/30 animate-pulse' : 'bg-yellow-400 hover:bg-yellow-300 text-yellow-900 rotate-3 hover:rotate-6'}`}
                            >
                                {isTimerRunning ? <i data-lucide="pause" className="w-8 h-8 fill-current" /> : <i data-lucide="play" className="w-8 h-8 fill-current ml-1" />}
                            </button>
                        </div>
                    </div>

                    {/* Stats Grid */}
                    <div className="grid grid-cols-2 gap-4">
                        <div className="bg-blue-50 dark:bg-blue-900/20 p-5 rounded-3xl flex flex-col items-center justify-center gap-2 border border-blue-100 dark:border-blue-800/30">
                            <i data-lucide="book-open" className="text-blue-500 w-6 h-6"/>
                            <span className="text-2xl font-black text-gray-800 dark:text-white">{(todayStudySeconds / 3600).toFixed(1)}h</span>
                            <span className="text-xs text-blue-400 font-bold">Ù…Ø·Ø§Ù„Ø¹Ù‡ Ø§Ù…Ø±ÙˆØ²</span>
                        </div>
                        <div className="bg-purple-50 dark:bg-purple-900/20 p-5 rounded-3xl flex flex-col items-center justify-center gap-2 border border-purple-100 dark:border-purple-800/30">
                            <i data-lucide="target" className="text-purple-500 w-6 h-6"/>
                            <span className="text-2xl font-black text-gray-800 dark:text-white">{completedTasks}/{totalTasks}</span>
                            <span className="text-xs text-purple-400 font-bold">ØªØ³Ú©â€ŒÙ‡Ø§ÛŒ Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯Ù‡</span>
                        </div>
                    </div>

                    {/* Chart */}
                    <div className="bg-white dark:bg-gray-800 p-6 rounded-[2rem] shadow-sm border border-gray-100 dark:border-gray-700/50">
                        <div className="flex justify-between items-center mb-6">
                            <h3 className="font-bold text-gray-700 dark:text-gray-200">Ù†Ù…ÙˆØ¯Ø§Ø± Ù‡ÙØªÙ‡</h3>
                            <div className="flex gap-2">
                                <span className="w-2 h-2 rounded-full bg-green-400 block mt-1.5"></span>
                                <span className="text-xs text-gray-400">Ø³Ø§Ø¹Øª Ù…Ø·Ø§Ù„Ø¹Ù‡</span>
                            </div>
                        </div>
                        <div className="flex justify-between items-end h-32 gap-2">
                            {chartData.map((data, idx) => (
                                <ChartBar key={idx} dayDate={data.dayDate} label={data.label} />
                            ))}
                        </div>
                    </div>

                    {/* Todo List */}
                    <div className="bg-white dark:bg-gray-800 p-6 rounded-[2rem] shadow-sm border border-gray-100 dark:border-gray-700/50">
                        <div className="flex justify-between items-center mb-4">
                            <h3 className="font-bold text-gray-700 dark:text-gray-200 flex items-center gap-2">
                                <span className="bg-yellow-100 dark:bg-yellow-900/50 p-1.5 rounded-lg text-yellow-600"><i data-lucide="list-todo" className="w-5 h-5"/></span>
                                Ù„ÛŒØ³Øª Ú©Ø§Ø±Ù‡Ø§
                            </h3>
                            <span className="text-xs font-bold text-gray-400 bg-gray-100 dark:bg-gray-700 px-2 py-1 rounded-md">{progress}%</span>
                        </div>

                        <div className="w-full bg-gray-100 dark:bg-gray-700 rounded-full h-2 mb-6 overflow-hidden">
                            <div className="bg-gradient-to-r from-green-400 to-green-500 h-2 rounded-full transition-all duration-700 ease-out" style={{ width: `${progress}%` }}></div>
                        </div>

                        <div className="flex gap-2 mb-4">
                            <input 
                                type="text" 
                                value={newTask}
                                onChange={(e) => setNewTask(e.target.value)}
                                onKeyDown={(e) => e.key === 'Enter' && addTask()}
                                placeholder="Ú†Ù‡ Ú©Ø§Ø±ÛŒ Ù…ÛŒØ®ÙˆØ§ÛŒ Ø§Ù†Ø¬Ø§Ù… Ø¨Ø¯ÛŒØŸ" 
                                className="flex-1 bg-gray-50 dark:bg-gray-700/50 dark:text-white px-5 py-3 rounded-2xl focus:outline-none focus:ring-2 focus:ring-green-400 transition-all text-sm font-medium border border-transparent focus:bg-white dark:focus:bg-gray-700"
                            />
                            <button onClick={addTask} className="bg-green-500 text-white w-12 rounded-2xl hover:bg-green-600 transition-colors shadow-lg shadow-green-500/20 flex items-center justify-center active:scale-95">
                                <i data-lucide="plus" className="w-6 h-6"/>
                            </button>
                        </div>
                        <div className="space-y-3">
                            {tasks.length === 0 && <div className="text-center py-8 opacity-50"><i data-lucide="clipboard-list" className="w-12 h-12 mx-auto mb-2 text-gray-300"/><p className="text-sm">Ù„ÛŒØ³Øª Ø®Ø§Ù„ÛŒÙ‡!</p></div>}
                            {tasks.map(task => (
                                <div key={task.id} className={`flex items-center justify-between p-4 rounded-2xl transition-all border group animate-fade-in ${task.done ? 'bg-green-50/50 dark:bg-green-900/10 border-green-100 dark:border-green-900/30' : 'bg-white dark:bg-gray-800 border-gray-100 dark:border-gray-700 hover:border-green-300 dark:hover:border-green-700'}`}>
                                    <div className="flex items-center gap-3 flex-1 overflow-hidden cursor-pointer" onClick={() => toggleTask(task.id)}>
                                        <div className={`w-6 h-6 rounded-full border-2 flex-shrink-0 flex items-center justify-center transition-colors ${task.done ? 'bg-green-500 border-green-500' : 'border-gray-300 dark:border-gray-600'}`}>
                                            {task.done && <i data-lucide="check" className="w-3.5 h-3.5 text-white"/>}
                                        </div>
                                        
                                        {editingTaskId === task.id ? (
                                            <form onSubmit={saveTaskEdit} className="flex-1 mr-2" onClick={e => e.stopPropagation()}>
                                                <input 
                                                    autoFocus
                                                    className="w-full bg-white dark:bg-gray-700 border border-green-400 rounded-lg px-2 py-1 text-sm outline-none dark:text-white"
                                                    value={editingText}
                                                    onChange={e => setEditingText(e.target.value)}
                                                    onBlur={saveTaskEdit}
                                                />
                                            </form>
                                        ) : (
                                            <span className={`text-sm font-medium truncate ${task.done ? 'line-through text-gray-400' : 'text-gray-700 dark:text-gray-200'}`}>{task.text}</span>
                                        )}
                                    </div>
                                    
                                    <div className="flex gap-2 mr-2 pl-1 opacity-100 sm:opacity-0 sm:group-hover:opacity-100 transition-opacity">
                                        <button onClick={(e) => startEditing(e, task)} className="w-8 h-8 flex items-center justify-center text-gray-400 hover:text-blue-500 hover:bg-blue-50 dark:hover:bg-blue-900/30 rounded-full transition-colors">
                                            <i data-lucide="pencil" className="w-4 h-4"/>
                                        </button>
                                        <button onClick={(e) => deleteTask(e, task.id)} className="w-8 h-8 flex items-center justify-center text-gray-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/30 rounded-full transition-colors">
                                            <i data-lucide="trash-2" className="w-4 h-4"/>
                                        </button>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
            );
        };

        // 3. Mojino (Actual AI Logic)
        const Mojino = () => {
            const [status, setStatus] = useState('idle'); // idle, input, processing, done
            const [inputText, setInputText] = useState('');
            const [resultType, setResultType] = useState('flashcard');
            const [aiData, setAiData] = useState(null);

            const handleAnalyze = () => {
                if (!inputText.trim() || inputText.length < 10) return;
                
                setStatus('processing');
                
                // Simulate processing time for better UX
                setTimeout(() => {
                    const result = processText(inputText);
                    setAiData(result);
                    setStatus('done');
                }, 1500);
            };

            const reset = () => {
                setStatus('idle');
                setResultType('flashcard');
                setInputText('');
            };

            return (
                <div className="space-y-6 pb-24 fade-in h-full flex flex-col">
                     <div className="bg-gradient-to-br from-indigo-600 to-violet-700 p-8 rounded-[2.5rem] text-white shadow-xl shadow-indigo-500/30 text-center relative overflow-hidden flex-shrink-0 min-h-[160px] flex flex-col items-center justify-center">
                        <div className="absolute top-0 left-0 w-full h-full opacity-20 bg-[radial-gradient(ellipse_at_top,_var(--tw-gradient-stops))] from-white via-transparent to-transparent"></div>
                        <h2 className="text-3xl font-black mb-2 flex justify-center items-center gap-2 tracking-tight relative z-10">
                            <i data-lucide="sparkles" className="w-8 h-8 text-yellow-300 animate-pulse" /> Ù…ÙˆØ¬ÛŒÙ†Ùˆ
                        </h2>
                        <p className="text-indigo-200 text-sm font-medium relative z-10">Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ ØªØ­Ù„ÛŒÙ„Ú¯Ø± Ø¯Ø±Ø³ÛŒ ØªÙˆ</p>
                    </div>

                    <div className="flex-1">
                        {status === 'idle' && (
                            <div className="space-y-4 animate-scale-in">
                                <div className="bg-white dark:bg-gray-800 p-6 rounded-[2rem] shadow-sm border border-gray-100 dark:border-gray-700/50 text-center">
                                    <i data-lucide="file-text" className="w-12 h-12 mx-auto text-indigo-500 mb-4"/>
                                    <h3 className="font-bold text-lg mb-2 dark:text-white">Ù…ØªÙ† Ø¯Ø±Ø³ÛŒ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯</h3>
                                    <p className="text-xs text-gray-500 mb-6">Ù…ÙˆØ¬ÛŒÙ†Ùˆ Ù…ØªÙ† Ø´Ù…Ø§ Ø±Ø§ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù†Ø¯ Ùˆ Ø¨Ø±Ø§ÛŒØªØ§Ù† ÙÙ„Ø´â€ŒÚ©Ø§Ø±ØªØŒ Ú©ÙˆÛŒÛŒØ² Ùˆ Ø®Ù„Ø§ØµÙ‡ Ù…ÛŒâ€ŒØ³Ø§Ø²Ø¯.</p>
                                    
                                    <textarea 
                                        className="w-full h-32 bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-2xl p-4 text-sm outline-none focus:ring-2 focus:ring-indigo-500 dark:text-white resize-none"
                                        placeholder="Ù…ØªÙ† Ø¬Ø²ÙˆÙ‡ ÛŒØ§ Ú©ØªØ§Ø¨ Ø®ÙˆØ¯ Ø±Ø§ Ø§ÛŒÙ†Ø¬Ø§ Ú©Ù¾ÛŒ Ú©Ù†ÛŒØ¯..."
                                        value={inputText}
                                        onChange={(e) => setInputText(e.target.value)}
                                    ></textarea>

                                    <button 
                                        onClick={handleAnalyze}
                                        disabled={!inputText.trim()}
                                        className="w-full mt-4 bg-indigo-600 hover:bg-indigo-700 disabled:bg-gray-300 disabled:cursor-not-allowed text-white font-bold py-3.5 rounded-xl shadow-lg shadow-indigo-500/30 transition-all active:scale-95 flex items-center justify-center gap-2"
                                    >
                                        <i data-lucide="wand-2" className="w-5 h-5"/>
                                        <span>ØªØ­Ù„ÛŒÙ„ Ù‡ÙˆØ´Ù…Ù†Ø¯</span>
                                    </button>
                                </div>
                            </div>
                        )}

                        {status === 'processing' && (
                            <div className="py-20 flex flex-col items-center justify-center text-center animate-fade-in">
                                <div className="relative w-24 h-24 mb-6">
                                    <div className="absolute inset-0 border-4 border-indigo-100 rounded-full"></div>
                                    <div className="absolute inset-0 border-4 border-indigo-600 rounded-full border-t-transparent animate-spin"></div>
                                    <div className="absolute inset-0 flex items-center justify-center">
                                        <span className="text-2xl">ğŸ§ </span>
                                    </div>
                                </div>
                                <h3 className="font-bold text-lg text-indigo-900 dark:text-indigo-300 mb-1">Ø¯Ø± Ø­Ø§Ù„ ØªÙÚ©Ø±...</h3>
                                <p className="text-sm text-gray-500">Ù…ÙˆØ¬ÛŒÙ†Ùˆ Ø¯Ø§Ø±Ù‡ Ù…ØªÙ† Ø±Ùˆ Ù…ÛŒØ®ÙˆÙ†Ù‡</p>
                            </div>
                        )}

                        {status === 'done' && aiData && (
                            <div className="space-y-4 animate-scale-in">
                                <div className="flex bg-white dark:bg-gray-800 p-1.5 rounded-2xl shadow-sm border border-gray-100 dark:border-gray-700/50">
                                    {['flashcard', 'quiz', 'summary'].map(t => (
                                        <button 
                                            key={t}
                                            onClick={() => setResultType(t)}
                                            className={`flex-1 py-2.5 rounded-xl text-xs font-bold transition-all flex items-center justify-center gap-1 ${resultType === t ? 'bg-indigo-100 dark:bg-indigo-900/50 text-indigo-700 dark:text-indigo-300' : 'text-gray-500 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700'}`}
                                        >
                                            {t === 'flashcard' && <i data-lucide="layers" className="w-4 h-4"/>}
                                            {t === 'quiz' && <i data-lucide="help-circle" className="w-4 h-4"/>}
                                            {t === 'summary' && <i data-lucide="align-right" className="w-4 h-4"/>}
                                            <span>{t === 'flashcard' ? 'ÙÙ„Ø´â€ŒÚ©Ø§Ø±Øª' : t === 'quiz' ? 'Ú©ÙˆÛŒÛŒØ²' : 'Ø®Ù„Ø§ØµÙ‡'}</span>
                                        </button>
                                    ))}
                                </div>

                                <div className="bg-white dark:bg-gray-800 p-6 rounded-[2rem] shadow-lg border border-gray-100 dark:border-gray-700/50 min-h-[300px]">
                                    {resultType === 'flashcard' && (
                                        <div className="space-y-4">
                                            {aiData.flashcards.length === 0 ? <p className="text-center text-gray-400 mt-10">Ù…ØªÙ† Ú©ÙˆØªØ§Ù‡ Ø¨ÙˆØ¯ØŒ ÙÙ„Ø´ Ú©Ø§Ø±ØªÛŒ Ø³Ø§Ø®ØªÙ‡ Ù†Ø´Ø¯.</p> : 
                                            aiData.flashcards.map((card, i) => (
                                                <div key={i} className="bg-orange-50 dark:bg-orange-900/20 p-5 rounded-2xl border border-orange-100 dark:border-orange-800/30 group cursor-pointer hover:shadow-md transition-all">
                                                    <div className="flex justify-between items-start mb-3">
                                                        <span className="bg-orange-200 dark:bg-orange-800 text-orange-800 dark:text-orange-200 text-[10px] px-2 py-0.5 rounded-md font-bold">Ú©Ø§Ø±Øª {i+1}</span>
                                                        <i data-lucide="flip-horizontal" className="w-4 h-4 text-orange-300"/>
                                                    </div>
                                                    <p className="font-bold text-gray-800 dark:text-gray-200 mb-4 leading-7">{card.q}</p>
                                                    <div className="h-0 overflow-hidden group-hover:h-auto transition-all opacity-0 group-hover:opacity-100">
                                                        <div className="pt-3 border-t border-orange-200 dark:border-orange-800/30 text-green-600 dark:text-green-400 font-black text-center">
                                                            {card.a}
                                                        </div>
                                                    </div>
                                                    <div className="group-hover:hidden text-center text-xs text-orange-400 mt-2">Ø¨Ø±Ø§ÛŒ Ø¯ÛŒØ¯Ù† Ø¬ÙˆØ§Ø¨ Ù†Ú¯Ù‡ Ø¯Ø§Ø±ÛŒØ¯</div>
                                                </div>
                                            ))}
                                        </div>
                                    )}

                                    {resultType === 'quiz' && (
                                        <div className="space-y-6">
                                            {aiData.quiz.length === 0 ? <p className="text-center text-gray-400 mt-10">Ù…ØªÙ† Ú©ÙˆØªØ§Ù‡ Ø¨ÙˆØ¯ØŒ Ú©ÙˆÛŒÛŒØ² Ø³Ø§Ø®ØªÙ‡ Ù†Ø´Ø¯.</p> :
                                            aiData.quiz.map((q, i) => (
                                                <div key={i} className="space-y-3">
                                                    <p className="font-bold text-gray-800 dark:text-gray-200 text-sm leading-6">
                                                        <span className="text-indigo-500 ml-1">{i+1}.</span> {q.question}
                                                    </p>
                                                    <div className="space-y-2 pr-4">
                                                        {q.options.map((opt, idx) => (
                                                            <button 
                                                                key={idx} 
                                                                className={`w-full text-right p-3 rounded-xl text-xs font-medium border transition-colors ${
                                                                    opt === q.answer 
                                                                    ? 'hover:bg-green-50 dark:hover:bg-green-900/20 hover:border-green-300 focus:bg-green-100 focus:border-green-500 focus:text-green-800' 
                                                                    : 'bg-gray-50 dark:bg-gray-700/50 border-transparent hover:bg-gray-100 dark:text-gray-300'
                                                                }`}
                                                            >
                                                                {opt}
                                                            </button>
                                                        ))}
                                                    </div>
                                                    {i < aiData.quiz.length - 1 && <div className="h-px bg-gray-100 dark:bg-gray-700 my-4"></div>}
                                                </div>
                                            ))}
                                        </div>
                                    )}

                                    {resultType === 'summary' && (
                                        <div className="bg-indigo-50 dark:bg-indigo-900/20 p-5 rounded-2xl border border-indigo-100 dark:border-indigo-800/30">
                                            <div className="flex items-center gap-2 mb-3">
                                                <i data-lucide="quote" className="w-5 h-5 text-indigo-400"/>
                                                <span className="font-bold text-indigo-700 dark:text-indigo-300 text-sm">Ø®Ù„Ø§ØµÙ‡ Ù…ØªÙ† Ø´Ù…Ø§</span>
                                            </div>
                                            <p className="text-sm leading-8 text-gray-700 dark:text-gray-300 text-justify">
                                                {aiData.summary}
                                            </p>
                                        </div>
                                    )}
                                </div>
                                
                                <button onClick={reset} className="w-full py-3 text-indigo-400 text-sm font-bold hover:text-indigo-600 transition-colors">
                                    ØªØ­Ù„ÛŒÙ„ Ù…ØªÙ† Ø¬Ø¯ÛŒØ¯
                                </button>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        // 4. Schedule (Unchanged mainly, kept for completeness)
        const Schedule = () => {
            const days = ['Ø´Ù†Ø¨Ù‡', 'ÛŒÚ©Ø´Ù†Ø¨Ù‡', 'Ø¯ÙˆØ´Ù†Ø¨Ù‡', 'Ø³Ù‡â€ŒØ´Ù†Ø¨Ù‡', 'Ú†Ù‡Ø§Ø±Ø´Ù†Ø¨Ù‡', 'Ù¾Ù†Ø¬â€ŒØ´Ù†Ø¨Ù‡'];
            const periods = ['Û¸:Û°Û° - Û¹:Û³Û°', 'Û¹:Û´Ûµ - Û±Û±:Û±Ûµ', 'Û±Û±:Û³Û° - Û±Û³:Û°Û°', 'Û±Û³:Û±Ûµ - Û±Û´:Û±Ûµ'];
            
            const [schoolData, setSchoolData] = useStickyState({}, 'mojito_school_schedule');
            const [personalData, setPersonalData] = useStickyState([
                {id: 1, subject: '', time: '', priority: 'Ø¨Ø§Ù„Ø§'}
            ], 'mojito_personal_schedule');

            const handleSchoolChange = (day, periodIndex, value) => {
                setSchoolData(prev => ({
                    ...prev,
                    [`${day}-${periodIndex}`]: value
                }));
            };

            const handlePersonalChange = (id, field, value) => {
                setPersonalData(prev => prev.map(item => item.id === id ? { ...item, [field]: value } : item));
            };

            const addPersonalItem = () => {
                setPersonalData([...personalData, { id: Date.now(), subject: '', time: '', priority: 'Ù…ØªÙˆØ³Ø·' }]);
            };

            const removePersonalItem = (id) => {
                setPersonalData(personalData.filter(item => item.id !== id));
            };

            return (
                <div className="space-y-6 pb-24 fade-in">
                    <div className="bg-white dark:bg-gray-800 p-6 rounded-[2rem] shadow-sm border border-gray-100 dark:border-gray-700/50">
                        <h3 className="font-bold text-gray-700 dark:text-gray-200 mb-6 flex items-center gap-2">
                            <span className="bg-green-100 dark:bg-green-900/50 p-1.5 rounded-lg text-green-600"><i data-lucide="school" className="w-5 h-5"/></span>
                            Ø¨Ø±Ù†Ø§Ù…Ù‡ Ù…Ø¯Ø±Ø³Ù‡
                        </h3>
                        <div className="overflow-x-auto pb-4 -mx-2 px-2">
                            <table className="w-full text-sm min-w-[600px] border-separate border-spacing-y-2">
                                <thead>
                                    <tr className="text-gray-400">
                                        <th className="pb-2 text-right w-24 font-medium text-xs">Ø±ÙˆØ² Ù‡ÙØªÙ‡</th>
                                        {periods.map((p, idx) => (
                                            <th key={idx} className="pb-2 px-1 text-center font-medium">
                                                <div className="bg-gray-50 dark:bg-gray-700/50 rounded-lg py-1">
                                                    <span className="block text-xs text-gray-800 dark:text-gray-200">Ø²Ù†Ú¯ {idx + 1}</span>
                                                    <span className="block text-[10px] opacity-60 dir-ltr">{p}</span>
                                                </div>
                                            </th>
                                        ))}
                                    </tr>
                                </thead>
                                <tbody className="text-gray-700 dark:text-gray-300">
                                    {days.map(day => (
                                        <tr key={day}>
                                            <td className="py-2 font-bold text-xs bg-white dark:bg-gray-800 sticky right-0 z-10 pl-2">{day}</td>
                                            {periods.map((_, idx) => (
                                                <td key={idx} className="px-1">
                                                    <input 
                                                        className="w-full bg-gray-50 dark:bg-gray-900/50 border border-transparent focus:border-green-400 rounded-xl px-2 py-3 outline-none text-center text-xs font-medium placeholder-gray-300 dark:placeholder-gray-600 dark:text-white focus:bg-white dark:focus:bg-gray-700 shadow-sm" 
                                                        placeholder="-" 
                                                        value={schoolData[`${day}-${idx}`] || ''}
                                                        onChange={(e) => handleSchoolChange(day, idx, e.target.value)}
                                                    />
                                                </td>
                                            ))}
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div className="bg-white dark:bg-gray-800 p-6 rounded-[2rem] shadow-sm border-t-4 border-yellow-400 relative">
                        <div className="absolute top-0 right-6 -mt-3 bg-yellow-400 text-yellow-900 text-[10px] font-bold px-3 py-1 rounded-full shadow-md">Ø´Ø®ØµÛŒ</div>
                        <h3 className="font-bold text-gray-700 dark:text-gray-200 mb-4 flex items-center gap-2 mt-2">
                            <span className="bg-yellow-100 dark:bg-yellow-900/50 p-1.5 rounded-lg text-yellow-600"><i data-lucide="calendar-check" className="w-5 h-5"/></span>
                             Ø¨Ø±Ù†Ø§Ù…Ù‡ Ù…Ø·Ø§Ù„Ø¹Ø§ØªÛŒ
                        </h3>
                         <div className="space-y-3">
                             {personalData.map((item, idx) => (
                                 <div key={item.id} className="flex flex-wrap sm:flex-nowrap gap-2 items-center bg-gray-50 dark:bg-gray-700/30 p-3 rounded-2xl group border border-transparent hover:border-gray-200 dark:hover:border-gray-600 transition-all">
                                    <div className="bg-gray-200 dark:bg-gray-600 text-gray-500 dark:text-gray-300 w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold shrink-0">{idx + 1}</div>
                                    <input 
                                        placeholder="Ù†Ø§Ù… Ø¯Ø±Ø³" 
                                        className="bg-transparent w-full sm:w-1/3 outline-none text-sm dark:text-white font-bold placeholder-gray-400" 
                                        value={item.subject}
                                        onChange={(e) => handlePersonalChange(item.id, 'subject', e.target.value)}
                                    />
                                    <div className="hidden sm:block h-4 w-px bg-gray-300 dark:bg-gray-600"></div>
                                    <input 
                                        placeholder="Ø²Ù…Ø§Ù† (Ù…Ø«Ù„Ø§ Û² Ø³Ø§Ø¹Øª)" 
                                        className="bg-transparent w-1/2 sm:w-1/4 outline-none text-sm text-right sm:text-center dark:text-white placeholder-gray-400"
                                        value={item.time}
                                        onChange={(e) => handlePersonalChange(item.id, 'time', e.target.value)}
                                    />
                                    <select 
                                        className="bg-transparent text-xs outline-none text-gray-500 font-medium ml-auto sm:ml-0"
                                        value={item.priority}
                                        onChange={(e) => handlePersonalChange(item.id, 'priority', e.target.value)}
                                    >
                                        <option>Ø¨Ø§Ù„Ø§</option>
                                        <option>Ù…ØªÙˆØ³Ø·</option>
                                        <option>Ù¾Ø§ÛŒÛŒÙ†</option>
                                    </select>
                                    <button 
                                        onClick={() => removePersonalItem(item.id)}
                                        className="text-gray-300 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/30 p-1.5 rounded-full transition-all"
                                    >
                                        <i data-lucide="x" className="w-4 h-4"/>
                                    </button>
                                 </div>
                             ))}
                             <button onClick={addPersonalItem} className="w-full py-3 border-2 border-dashed border-gray-200 dark:border-gray-700 rounded-2xl text-gray-400 text-sm font-bold hover:border-green-400 hover:text-green-500 hover:bg-green-50 dark:hover:bg-green-900/10 transition-all">
                                + Ø§ÙØ²ÙˆØ¯Ù† ØªØ§ÛŒÙ… Ù…Ø·Ø§Ù„Ø¹Ù‡
                             </button>
                         </div>
                    </div>
                </div>
            );
        };

        // 5. Settings
        const Settings = ({ user, toggleTheme, isDark, onUpdateProfile }) => {
            const [showEditModal, setShowEditModal] = useState(false);
            const [editName, setEditName] = useState(user.name);
            const fileInputRef = useRef(null);

            const handleSaveProfile = () => {
                if (editName) {
                    onUpdateProfile({ ...user, name: editName });
                    setShowEditModal(false);
                }
            };

            const handleAvatarClick = () => {
                fileInputRef.current.click();
            };

            const handleFileChange = (e) => {
                const file = e.target.files[0];
                if (file) {
                    if (file.size > 1024 * 1024) { // 1MB limit check
                        alert('Ø­Ø¬Ù… Ø¹Ú©Ø³ Ù†Ø¨Ø§ÛŒØ¯ Ø¨ÛŒØ´ØªØ± Ø§Ø² Û± Ù…Ú¯Ø§Ø¨Ø§ÛŒØª Ø¨Ø§Ø´Ø¯');
                        return;
                    }
                    const reader = new FileReader();
                    reader.onloadend = () => {
                        onUpdateProfile({ ...user, avatar: reader.result });
                    };
                    reader.readAsDataURL(file);
                }
            };

            return (
                <div className="space-y-6 pb-24 fade-in">
                    <div className="flex flex-col items-center py-8">
                        <div className="relative group cursor-pointer" onClick={handleAvatarClick}>
                            <div className="w-28 h-28 bg-gray-100 rounded-full mb-4 overflow-hidden border-4 border-white dark:border-gray-800 shadow-xl relative">
                                <img src={user.avatar || `https://api.dicebear.com/7.x/notionists/svg?seed=${user.name}`} alt="Profile" className="w-full h-full object-cover bg-yellow-100" />
                                <div className="absolute inset-0 bg-black/40 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity">
                                    <i data-lucide="camera" className="text-white w-8 h-8"/>
                                </div>
                            </div>
                            <input 
                                type="file" 
                                ref={fileInputRef} 
                                accept="image/*" 
                                onChange={handleFileChange}
                            />
                            <div className="absolute bottom-4 right-0 bg-green-500 p-1.5 rounded-full border-2 border-white dark:border-gray-800 pointer-events-none">
                                <i data-lucide="edit-2" className="w-3 h-3 text-white"/>
                            </div>
                        </div>
                        <h2 className="text-2xl font-black dark:text-white">{user.name || 'Ú©Ø§Ø±Ø¨Ø± Ù…Ù‡Ù…Ø§Ù†'}</h2>
                        <p className="text-gray-400 text-xs mt-1">Ø¯Ø§Ù†Ø´ Ø¢Ù…ÙˆØ² Ú©ÙˆØ´Ø§</p>
                    </div>

                    <div className="bg-white dark:bg-gray-800 rounded-[2rem] overflow-hidden shadow-sm border border-gray-100 dark:border-gray-700/50">
                        <button 
                            onClick={() => {
                                setEditName(user.name);
                                setShowEditModal(true);
                            }}
                            className="w-full flex items-center justify-between p-5 border-b border-gray-100 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors group"
                        >
                            <div className="flex items-center gap-4">
                                <div className="bg-blue-50 dark:bg-blue-900/30 p-3 rounded-2xl text-blue-600 dark:text-blue-400 group-hover:scale-110 transition-transform"><i data-lucide="user" className="w-5 h-5"/></div>
                                <span className="font-bold text-gray-700 dark:text-gray-200">ÙˆÛŒØ±Ø§ÛŒØ´ Ù†Ø§Ù…</span>
                            </div>
                            <i data-lucide="chevron-left" className="text-gray-300 w-5 h-5"/>
                        </button>
                        
                        <div className="w-full flex items-center justify-between p-5 border-b border-gray-100 dark:border-gray-700">
                            <div className="flex items-center gap-4">
                                <div className="bg-purple-50 dark:bg-purple-900/30 p-3 rounded-2xl text-purple-600 dark:text-purple-400"><i data-lucide="moon" className="w-5 h-5"/></div>
                                <span className="font-bold text-gray-700 dark:text-gray-200">Ø­Ø§Ù„Øª Ø´Ø¨</span>
                            </div>
                            <button 
                                onClick={toggleTheme}
                                className={`w-14 h-8 rounded-full p-1 transition-colors duration-300 shadow-inner ${isDark ? 'bg-indigo-500' : 'bg-gray-200'}`}
                            >
                                <div className={`bg-white w-6 h-6 rounded-full shadow-md transform transition-transform duration-300 flex items-center justify-center ${isDark ? '-translate-x-6' : 'translate-x-0'}`}>
                                    {isDark ? <i data-lucide="moon" className="w-3 h-3 text-indigo-500 fill-current"/> : <i data-lucide="sun" className="w-4 h-4 text-yellow-500 fill-current"/>}
                                </div>
                            </button>
                        </div>
                        
                        <a href="#" className="w-full flex items-center justify-between p-5 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors group">
                            <div className="flex items-center gap-4">
                                <div className="bg-pink-50 dark:bg-pink-900/30 p-3 rounded-2xl text-pink-600 dark:text-pink-400 group-hover:scale-110 transition-transform"><i data-lucide="message-circle" className="w-5 h-5"/></div>
                                <div className="flex flex-col items-start">
                                    <span className="font-bold text-gray-700 dark:text-gray-200">Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ</span>
                                    <span className="text-xs text-gray-400 font-medium">Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ù…Ø§ : mojino_academy@</span>
                                </div>
                            </div>
                            <i data-lucide="external-link" className="text-gray-300 w-4 h-4"/>
                        </a>
                    </div>
                    
                    <button 
                        onClick={() => {
                            if(confirm('Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø´Ù…Ø§ Ù¾Ø§Ú© Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯.')) {
                                localStorage.clear();
                                window.location.reload();
                            }
                        }}
                        className="w-full text-red-500 text-sm font-bold py-4 opacity-60 hover:opacity-100 transition-opacity"
                    >
                        Ø®Ø±ÙˆØ¬ Ø§Ø² Ø­Ø³Ø§Ø¨ Ú©Ø§Ø±Ø¨Ø±ÛŒ
                    </button>

                    {/* Modal */}
                    {showEditModal && (
                        <div className="fixed inset-0 bg-black/60 z-[60] flex items-center justify-center p-6 backdrop-blur-sm animate-fade-in">
                            <div className="bg-white dark:bg-gray-800 p-6 rounded-[2rem] w-full max-w-xs shadow-2xl slide-up">
                                <h3 className="text-lg font-black mb-6 dark:text-white text-center">ÙˆÛŒØ±Ø§ÛŒØ´ Ù…Ø´Ø®ØµØ§Øª</h3>
                                
                                <div className="space-y-4">
                                    <div>
                                        <label className="text-xs font-bold text-gray-400 mb-2 block mr-1">Ù†Ø§Ù… Ø´Ù…Ø§</label>
                                        <input 
                                            value={editName}
                                            onChange={(e) => setEditName(e.target.value)}
                                            className="w-full bg-gray-50 dark:bg-gray-900 dark:text-white border border-transparent focus:border-green-400 rounded-xl px-4 py-3 outline-none transition-all"
                                        />
                                    </div>
                                </div>

                                <div className="flex gap-3 mt-8">
                                    <button onClick={handleSaveProfile} className="flex-1 bg-green-500 text-white font-bold py-3 rounded-xl hover:bg-green-600 shadow-lg shadow-green-500/20 transition-all">
                                        Ø°Ø®ÛŒØ±Ù‡
                                    </button>
                                    <button onClick={() => setShowEditModal(false)} className="flex-1 bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 font-bold py-3 rounded-xl hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors">
                                        Ù„ØºÙˆ
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const Navbar = ({ activeTab, setActiveTab }) => {
            const tabs = [
                { id: 'study', icon: 'home', label: 'Ø§ØªØ§Ù‚' },
                { id: 'mojino', icon: 'bot', label: 'Ù…ÙˆØ¬ÛŒÙ†Ùˆ' },
                { id: 'schedule', icon: 'calendar', label: 'Ø¨Ø±Ù†Ø§Ù…Ù‡' },
                { id: 'settings', icon: 'settings', label: 'ØªÙ†Ø¸ÛŒÙ…Ø§Øª' },
            ];

            return (
                <div className="fixed bottom-0 left-0 w-full bg-white/90 dark:bg-gray-900/90 backdrop-blur-md border-t border-gray-100 dark:border-gray-800 pb-safe pt-2 px-6 shadow-[0_-10px_40px_rgba(0,0,0,0.05)] z-50">
                    <div className="flex justify-between items-end pb-4 max-w-md mx-auto">
                        {tabs.map(tab => {
                            const isActive = activeTab === tab.id;
                            return (
                                <button 
                                    key={tab.id}
                                    onClick={() => setActiveTab(tab.id)}
                                    className={`flex flex-col items-center gap-1.5 transition-all duration-300 w-16 ${isActive ? 'text-green-600 dark:text-green-400 -translate-y-2' : 'text-gray-400 hover:text-gray-600'}`}
                                >
                                    <div className={`p-3 rounded-2xl transition-all duration-500 ${isActive ? 'bg-green-50 dark:bg-green-900/30 shadow-lg shadow-green-100 dark:shadow-none rotate-3' : 'hover:bg-gray-50 dark:hover:bg-gray-800'}`}>
                                        <i data-lucide={tab.icon} className={`w-6 h-6 transition-transform ${isActive ? 'fill-current scale-110' : ''}`} />
                                    </div>
                                    <span className={`text-[10px] font-bold transition-all duration-300 ${isActive ? 'opacity-100 translate-y-0' : 'opacity-0 -translate-y-2 h-0 overflow-hidden'}`}>{tab.label}</span>
                                </button>
                            )
                        })}
                    </div>
                </div>
            );
        };

        // --- Main App ---
        const App = () => {
            const [user, setUser] = useStickyState(null, 'mojito_user');
            const [activeTab, setActiveTab] = useState('study');
            const [darkMode, setDarkMode] = useStickyState(false, 'mojito_darkmode');
            const [toast, setToast] = useState(null);

            useEffect(() => {
                if (window.lucide) {
                    window.lucide.createIcons();
                }
            });
            
            useEffect(() => {
                if (darkMode) {
                    document.documentElement.classList.add('dark');
                } else {
                    document.documentElement.classList.remove('dark');
                }
            }, [darkMode]);

            const handleLogin = (userData) => {
                setUser(userData);
                setToast({ message: 'Ø®ÙˆØ´ Ø§ÙˆÙ…Ø¯ÛŒ Ø¨Ù‡ Ù…ÙˆÙ‡ÛŒØªÙˆ!', type: 'success' });
            };

            const toggleTheme = () => {
                setDarkMode(!darkMode);
            };
            
            const handleUpdateProfile = (updatedUser) => {
                setUser(updatedUser);
                setToast({ message: 'Ù¾Ø±ÙˆÙØ§ÛŒÙ„ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ø±ÙˆØ² Ø´Ø¯!', type: 'success' });
            };

            return (
                <div className={`min-h-screen ${darkMode ? 'dark bg-gray-900' : 'bg-gray-50'} transition-colors duration-500`}>
                    {toast && <Toast message={toast.message} type={toast.type} onClose={() => setToast(null)} />}
                    
                    {!user ? (
                        <AuthScreen onLogin={handleLogin} />
                    ) : (
                        <div className="max-w-md mx-auto min-h-screen relative shadow-2xl bg-gray-50 dark:bg-gray-900 transition-colors duration-300 pb-20">
                            <main className="p-5 pt-6">
                                {activeTab === 'study' && <StudyRoom user={user} />}
                                {activeTab === 'mojino' && <Mojino />}
                                {activeTab === 'schedule' && <Schedule />}
                                {activeTab === 'settings' && <Settings user={user} toggleTheme={toggleTheme} isDark={darkMode} onUpdateProfile={handleUpdateProfile} />}
                            </main>
                            <Navbar activeTab={activeTab} setActiveTab={setActiveTab} />
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>